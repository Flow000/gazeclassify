from gazeclassify.core.services.analysis import Analysis
from gazeclassify.core.services.instance_classifier import InstanceSegmentation
from gazeclassify.serializer.pupil_data_loader import PupilInvisibleLoader


def test_run_instance_segmentation_on_two_frame_trial() -> None:
    analysis = Analysis()
    PupilInvisibleLoader(analysis).from_trial_folder("gazeclassify/example_data")
    InstanceSegmentation(analysis).classify("Human_Joints")

    import json
    results = json.dumps(analysis.results, default=lambda x: x.__dict__)

    assert results == '[{"frame_id": 0, "name": "Human_Joints", "classifications": [{"distance": 677.1754131941278, "joint": "Neck", "person_id": 0}, {"distance": 592.8860583803199, "joint": "Right Shoulder", "person_id": 0}, {"distance": 609.2800203217555, "joint": "Right Elbow", "person_id": 0}, {"distance": 610.6028813518858, "joint": "Right Wrist", "person_id": 0}, {"distance": 692.274247254679, "joint": "Right Hip", "person_id": 0}, {"distance": 740.2870996569113, "joint": "Right Knee", "person_id": 0}, {"distance": 604.968815401321, "joint": "Right Knee", "person_id": 1}, {"distance": 773.7359080160629, "joint": "Right Ankle", "person_id": 0}, {"distance": 637.1596426413015, "joint": "Right Ankle", "person_id": 1}, {"distance": 708.2476434718593, "joint": "Left Hip", "person_id": 0}, {"distance": 617.4385464801228, "joint": "Left Knee", "person_id": 2}, {"distance": 637.9877185531046, "joint": "Left Ankle", "person_id": 2}, {"distance": 592.1046430911656, "joint": "Right Eye", "person_id": 3}, {"distance": 607.3442182498537, "joint": "Left Eye", "person_id": 3}, {"distance": 608.0467640054497, "joint": "Left Ear", "person_id": 3}]}, {"frame_id": 1, "name": "Human_Joints", "classifications": [{"distance": 607.3546583432117, "joint": "Neck", "person_id": 0}, {"distance": 677.1746762919145, "joint": "Neck", "person_id": 3}, {"distance": 592.8341868892161, "joint": "Right Shoulder", "person_id": 0}, {"distance": 677.1746762919145, "joint": "Right Shoulder", "person_id": 1}, {"distance": 609.190011803731, "joint": "Right Elbow", "person_id": 0}, {"distance": 692.1556987781452, "joint": "Right Elbow", "person_id": 1}, {"distance": 610.6015509203531, "joint": "Right Wrist", "person_id": 0}, {"distance": 677.1746762919145, "joint": "Left Shoulder", "person_id": 2}, {"distance": 675.0662633239185, "joint": "Left Elbow", "person_id": 2}, {"distance": 625.3906248546692, "joint": "Left Wrist", "person_id": 2}, {"distance": 628.0176933226834, "joint": "Right Hip", "person_id": 0}, {"distance": 708.3017381697135, "joint": "Right Hip", "person_id": 3}, {"distance": 645.9382572389679, "joint": "Right Knee", "person_id": 0}, {"distance": 740.7512489397185, "joint": "Right Knee", "person_id": 3}, {"distance": 772.99376262107, "joint": "Right Ankle", "person_id": 3}, {"distance": 708.2467029170027, "joint": "Left Hip", "person_id": 3}, {"distance": 659.7843374437742, "joint": "Left Knee", "person_id": 4}, {"distance": 682.25371420488, "joint": "Left Ankle", "person_id": 4}, {"distance": 592.103421238941, "joint": "Right Eye", "person_id": 5}, {"distance": 607.3430999959015, "joint": "Left Eye", "person_id": 5}, {"distance": 675.8932747169338, "joint": "Left Eye", "person_id": 6}, {"distance": 675.8932747169338, "joint": "Right Ear", "person_id": 2}, {"distance": 608.0456503551383, "joint": "Left Ear", "person_id": 5}]}]'
